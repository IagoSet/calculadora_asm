try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8b85a7cc-fc65-4623-a785-90fc8a224214",e._sentryDebugIdIdentifier="sentry-dbid-8b85a7cc-fc65-4623-a785-90fc8a224214")}catch(e){}"use strict";exports.id=6040,exports.ids=[6040],exports.modules={76040:(e,t,a)=>{a.d(t,{ENV_CMDS_FULL_URI:()=>g,ENV_CMDS_RELATIVE_URI:()=>v,fromContainerMetadata:()=>y,fromInstanceMetadata:()=>$,getInstanceMetadataEndpoint:()=>M,httpRequest:()=>l});var n,r,o=a(68696),i=a(17360),s=a(78893),c=a(32615);function l(e){return new Promise((t,a)=>{let n=(0,c.request)({method:"GET",...e,hostname:e.hostname?.replace(/^\[(.+)\]$/,"$1")});n.on("error",e=>{a(Object.assign(new o.kb("Unable to connect to instance metadata service"),e)),n.destroy()}),n.on("timeout",()=>{a(new o.kb("TimeoutError from instance metadata service")),n.destroy()}),n.on("response",e=>{let{statusCode:r=400}=e;(r<200||300<=r)&&(a(Object.assign(new o.kb("Error response received from instance metadata service"),{statusCode:r})),n.destroy());let i=[];e.on("data",e=>{i.push(e)}),e.on("end",()=>{t(s.Buffer.concat(i)),n.destroy()})}),n.end()})}let d=e=>!!e&&"object"==typeof e&&"string"==typeof e.AccessKeyId&&"string"==typeof e.SecretAccessKey&&"string"==typeof e.Token&&"string"==typeof e.Expiration,u=e=>({accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:new Date(e.Expiration),...e.AccountId&&{accountId:e.AccountId}}),p=1e3,f=0,h=({maxRetries:e=f,timeout:t=p})=>({maxRetries:e,timeout:t}),m=(e,t)=>{let a=e();for(let n=0;n<t;n++)a=a.catch(e);return a},g="AWS_CONTAINER_CREDENTIALS_FULL_URI",v="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",w="AWS_CONTAINER_AUTHORIZATION_TOKEN",y=(e={})=>{let{timeout:t,maxRetries:a}=h(e);return()=>m(async()=>{let a=await E({logger:e.logger}),n=JSON.parse(await I(t,a));if(!d(n))throw new o.mV("Invalid response received from instance metadata service.",{logger:e.logger});return u(n)},a)},I=async(e,t)=>(process.env[w]&&(t.headers={...t.headers,Authorization:process.env[w]}),(await l({...t,timeout:e})).toString()),_={localhost:!0,"127.0.0.1":!0},b={"http:":!0,"https:":!0},E=async({logger:e})=>{if(process.env[v])return{hostname:"169.254.170.2",path:process.env[v]};if(process.env[g]){let t=(0,i.parse)(process.env[g]);if(!t.hostname||!(t.hostname in _))throw new o.mV(`${t.hostname} is not a valid container metadata service hostname`,{tryNextLink:!1,logger:e});if(!t.protocol||!(t.protocol in b))throw new o.mV(`${t.protocol} is not a valid container metadata service protocol`,{tryNextLink:!1,logger:e});return{...t,port:t.port?parseInt(t.port,10):void 0}}throw new o.mV(`The container metadata credential provider cannot be used unless the ${v} or ${g} environment variable is set`,{tryNextLink:!1,logger:e})};var A=a(99635);class S extends o.mV{constructor(e,t=!0){super(e,t),this.tryNextLink=t,this.name="InstanceMetadataV1FallbackError",Object.setPrototypeOf(this,S.prototype)}}var T=a(36961);!function(e){e.IPv4="http://169.254.169.254",e.IPv6="http://[fd00:ec2::254]"}(n||(n={}));let D={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT,configFileSelector:e=>e.ec2_metadata_service_endpoint,default:void 0};!function(e){e.IPv4="IPv4",e.IPv6="IPv6"}(r||(r={}));let k={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE,configFileSelector:e=>e.ec2_metadata_service_endpoint_mode,default:r.IPv4},M=async()=>(0,T.e)(await N()||await x()),N=async()=>(0,A.M)(D)(),x=async()=>{let e=await (0,A.M)(k)();switch(e){case r.IPv4:return n.IPv4;case r.IPv6:return n.IPv6;default:throw Error(`Unsupported endpoint mode: ${e}. Select from ${Object.values(r)}`)}},V=(e,t)=>{let a=new Date(Date.now()+1e3*(300+Math.floor(300*Math.random())));t.warn(`Attempting credential expiration extension due to a credential service availability issue. A refresh of these credentials will be attempted after ${new Date(a)}.
For more information, please visit: https://docs.aws.amazon.com/sdkref/latest/guide/feature-static-credentials.html`);let n=e.originalExpiration??e.expiration;return{...e,...n?{originalExpiration:n}:{},expiration:a}},C=(e,t={})=>{let a;let n=t?.logger||console;return async()=>{let t;try{(t=await e()).expiration&&t.expiration.getTime()<Date.now()&&(t=V(t,n))}catch(e){if(a)n.warn("Credential renew failed: ",e),t=V(a,n);else throw e}return a=t,t}},O="/latest/meta-data/iam/security-credentials/",P="AWS_EC2_METADATA_V1_DISABLED",R="ec2_metadata_v1_disabled",L="x-aws-ec2-metadata-token",$=(e={})=>C(K(e),{logger:e.logger}),K=(e={})=>{let t=!1,{logger:a,profile:n}=e,{timeout:r,maxRetries:i}=h(e),s=async(a,r)=>{if(t||r.headers?.[L]==null){let t=!1,a=!1,r=await (0,A.M)({environmentVariableSelector:t=>{let n=t[P];if(a=!!n&&"false"!==n,void 0===n)throw new o.mV(`${P} not set in env, checking config file next.`,{logger:e.logger});return a},configFileSelector:e=>{let a=e[R];return t=!!a&&"false"!==a},default:!1},{profile:n})();if(e.ec2MetadataV1Disabled||r){let n=[];throw e.ec2MetadataV1Disabled&&n.push("credential provider initialization (runtime option ec2MetadataV1Disabled)"),t&&n.push(`config file profile (${R})`),a&&n.push(`process environment variable (${P})`),new S(`AWS EC2 Metadata v1 fallback has been blocked by AWS SDK configuration in the following: [${n.join(", ")}].`)}}let i=(await m(async()=>{let e;try{e=await W(r)}catch(e){throw 401===e.statusCode&&(t=!1),e}return e},a)).trim();return m(async()=>{let a;try{a=await j(i,r,e)}catch(e){throw 401===e.statusCode&&(t=!1),e}return a},a)};return async()=>{let e=await M();if(t)return a?.debug("AWS SDK Instance Metadata","using v1 fallback (no token fetch)"),s(i,{...e,timeout:r});{let n;try{n=(await U({...e,timeout:r})).toString()}catch(n){if(n?.statusCode===400)throw Object.assign(n,{message:"EC2 Metadata token request returned error"});return("TimeoutError"===n.message||[403,404,405].includes(n.statusCode))&&(t=!0),a?.debug("AWS SDK Instance Metadata","using v1 fallback (initial)"),s(i,{...e,timeout:r})}return s(i,{...e,headers:{[L]:n},timeout:r})}}},U=async e=>l({...e,path:"/latest/api/token",method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"21600"}}),W=async e=>(await l({...e,path:O})).toString(),j=async(e,t,a)=>{let n=JSON.parse((await l({...t,path:O+e})).toString());if(!d(n))throw new o.mV("Invalid response received from instance metadata service.",{logger:a.logger});return u(n)}}};
//# sourceMappingURL=6040.js.map