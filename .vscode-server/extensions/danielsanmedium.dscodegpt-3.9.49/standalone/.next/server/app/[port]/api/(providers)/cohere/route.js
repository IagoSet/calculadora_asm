try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a1475b9e-81b0-4257-a700-f6b6cb74f20e",e._sentryDebugIdIdentifier="sentry-dbid-a1475b9e-81b0-4257-a700-f6b6cb74f20e")}catch(e){}"use strict";(()=>{var e={};e.id=5322,e.ids=[5322],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},74675:e=>{e.exports=require("node:assert")},92761:e=>{e.exports=require("node:async_hooks")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},40027:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},95953:e=>{e.exports=require("node:dns")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},42725:e=>{e.exports=require("node:http2")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},38846:e=>{e.exports=require("node:perf_hooks")},39630:e=>{e.exports=require("node:querystring")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},93746:e=>{e.exports=require("node:util/types")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},74471:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{DELETE:()=>S,GET:()=>T,HEAD:()=>_,OPTIONS:()=>C,PATCH:()=>E,POST:()=>k,PUT:()=>P});var s=r(88622),n=r(54580),a=r(25187),i=r(38485),p=r(45219),d=r(48449),u=r(50838),l=r(22815),c=r(95403),h=r(34160),x=r(81256),m=r(65195),g=e([a,i,p,u,h,m]);async function f(e,t){let r=e.body?.getReader();if(!r)throw Error("No reader available");let o="";return new ReadableStream({async start(e){let s=new TextDecoder,n=new TextEncoder;for(t?.onStart?.();;){let{done:a,value:i}=await r.read();if(a){e.close(),t?.onFinal?.(o),t?.onCompletion?.(o);return}for(let r of s.decode(i).split("\n"))try{if(!r)continue;let s=JSON.parse(r.trim()),a=s?.text;if(a){let r=n.encode(a);e.enqueue(r),t?.onToken?.(a),o+=a}}catch{}}},cancel(){t?.onFinal?.(o),r.releaseLock()}})}async function q(){return Response.json("",{status:i.ZI.getByProvider("Cohere")?.apikey?200:401})}async function y(e){let{messages:t}=await e.json();t=await (0,u.Dz)({messages:t,provider:"Cohere"});let r=e.headers.get("model")||"command",o=e.headers.get("filePath"),s=e.headers.get("promptType"),n=await m.Z.getLanguage(),g=await m.Z.getIdeLanguage(),q=e.headers.get("fileName")??"",y="Chat",w=t[t.length-1],v=w?.codeSelection??"";if(s){y=s+"CodeGPT";let e=await (0,l.u)({promptType:s,cleanPromptText:w.content+v,language:g});e&&(t[t.length-1].content=e+w.content+v)}if(o){let e=JSON.stringify(await (0,a.getFileContent)(o),null,2);t[t.length-1].content+=`${o}

    ${e}`}if(!t.some(e=>"system"===e.role)){let e=await (0,d.Ox)({provider:"cohere",model:r});t.unshift({role:"system",content:e||"I am a helpful programming expert assistant. If you ask me a question that is rooted in truth. Follow the user's instructions with precision and attention to detail. Provide the code in a single block. Minimize any additional text."})}let b=t.slice(0,t.length-1),T=[];for(let e=0;e<b.length;e++){let t={role:"user"===b[e].role?"User":"Chatbot",message:b[e].content};T.push(t)}let k=i.ZI.getByProvider("Cohere"),P=i.vc.getByProvider("Cohere"),E=JSON.stringify({model:r,message:t[t.length-1].content,preamble_override:"",prompt_truncation:"auto",temperature:P?.temperature??.3,stream:!0,chat_history:T,return_prompt:!0}),S=(0,x.q)(t.map(e=>e.content).join(""));try{if(!k?.apikey){let e=Error("You need to set your API key first.");throw e.status=401,e}t=(0,u.VL)(t);let e=await fetch("https://api.cohere.ai/v1/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k?.apikey}`},body:E});if(!e.ok){let t=await e.text(),r=Error(t);throw r.status=e.status,r}let a=await f(e,{onFinal:async e=>{let t=(0,x.q)(e);await (0,p.sendEvent)({eventName:y,provider:"Cohere",model:r??"command",promptTokens:S,completionTokens:t,totalTokens:S+t,statusCode:200})}}),i=t.slice(0,-1).some(e=>e.content.includes(v));if(o||v&&(s||!i)){let e=await (0,h.VU)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${s?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${s}</span></span>`:""}${q?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${n} data-language=${n}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${q}</span></span>`:""}${o?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-language=${o.split("/").pop()?.split(".").pop()}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${o.split("/").pop()}</span></span>`:""}</p>

`],a);return new c.w(e)}return new c.w(a)}catch(e){return(0,p.sendEvent)({eventName:y,provider:"Cohere",model:r,promptTokens:S,totalTokens:S,statusCode:e.status??500}),Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}[a,i,p,u,h,m]=g.then?(await g)():g;let v={...n},b="workUnitAsyncStorage"in v?v.workUnitAsyncStorage:"requestAsyncStorage"in v?v.requestAsyncStorage:void 0;function w(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,o)=>{let n;try{let e=b?.getStore();n=e?.headers}catch(e){}return s.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/[port]/api/(providers)/cohere",headers:n}).apply(r,o)}})}let T=w(void 0,"GET"),k=w(y,"POST"),P=w(void 0,"PUT"),E=w(void 0,"PATCH"),S=w(void 0,"DELETE"),_=w(q,"HEAD"),C=w(void 0,"OPTIONS");o()}catch(e){o(e)}})},32393:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>d,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var s=r(97988),n=r(7773),a=r(94049),i=r(74471),p=e([i]);i=(p.then?(await p)():p)[0];let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/[port]/api/(providers)/cohere/route",pathname:"/[port]/api/cohere",filename:"route",bundlePath:"app/[port]/api/(providers)/cohere/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/cohere/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:h}=u,x="/[port]/api/(providers)/cohere/route";function d(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}o()}catch(e){o(e)}})},97988:(e,t,r)=>{e.exports=r(30517)},95403:(e,t,r)=>{r.d(t,{w:()=>o});class o extends Response{constructor(e,t){super(e,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...t?.headers}})}}},81256:(e,t,r)=>{r.d(t,{q:()=>s});var o=r(981);let s=(e,t)=>(0,o.b9)(t??"gpt-4").encode(e).length??0}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[2355,8622,8341,8823,6703,5538,2806,981,3474,5203,4554,5370,3228,3536],()=>r(32393));module.exports=o})();
//# sourceMappingURL=route.js.map