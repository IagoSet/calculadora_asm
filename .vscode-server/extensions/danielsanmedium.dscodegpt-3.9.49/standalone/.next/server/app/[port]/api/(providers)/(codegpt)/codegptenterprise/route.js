try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="91857be0-1f8e-455e-8d94-2edcccd6120b",e._sentryDebugIdIdentifier="sentry-dbid-91857be0-1f8e-455e-8d94-2edcccd6120b")}catch(e){}"use strict";(()=>{var e={};e.id=8398,e.ids=[8398],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},74675:e=>{e.exports=require("node:assert")},92761:e=>{e.exports=require("node:async_hooks")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},40027:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},95953:e=>{e.exports=require("node:dns")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},42725:e=>{e.exports=require("node:http2")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},38846:e=>{e.exports=require("node:perf_hooks")},39630:e=>{e.exports=require("node:querystring")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},93746:e=>{e.exports=require("node:util/types")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},90635:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{DELETE:()=>C,GET:()=>b,HEAD:()=>E,OPTIONS:()=>_,PATCH:()=>k,POST:()=>P,PUT:()=>T});var s=r(88622),n=r(54580),a=r(38485),i=r(45219),p=r(48449),d=r(50838),u=r(22815),c=r(95403),l=r(34160),g=r(65195),x=e([a,i,d,l,g]);async function m(e,t){let r=e.body?.getReader();if(!r)throw Error("No reader available");return new ReadableStream({async start(e){let t=new TextDecoder;for(;;){let{done:o,value:s}=await r.read();if(o){e.close();return}s&&(e.enqueue(s),t.decode(s))}},cancel(){r.releaseLock()}})}async function h(){return Response.json("",{status:a.ZI.getByProvider("CodeGPT Enterprise")?.apikey?200:401})}async function y(){let e=a.ZI.getByProvider("CodeGPT Enterprise"),t=e?.custom_link;try{let r=e?.organization_id,o=e?.apikey;if(!o)return Response.json({agents:[],marketplace:[]});let s={Authorization:`Bearer ${o||""}`,"Content-Type":"application/json",...r?{"CodeGPT-Org-Id":r}:{},"Access-Control-Allow-Origin":"*"},n=await Promise.all([fetch(`${t}/agents`,{headers:s}).then(e=>e.json()),fetch(`${t}/agents/marketplace-favorites`,{headers:s}).then(e=>e.json())]);return Response.json({agents:Array.isArray(n[0])?n[0]:[],marketplace:Array.isArray(n[1])?n[1]:[]})}catch(e){return console.log(e),Response.json(e.message,{status:e.status??500})}}async function f(e){var t;let r=a.ZI.getByProvider("CodeGPT Enterprise"),o=r?.custom_link,{messages:s}=await e.json(),n=(s=await (0,d.Dz)({messages:s,provider:"CodeGPT Enterprise"}))[s.length-1],{image:x}=n,h=x?"gpt-4o":e.headers.get("model"),y="true"===e.headers.get("fromMarketplace"),f=e.headers.get("promptType"),q=await g.Z.getLanguage(),w=await g.Z.getIdeLanguage(),v=e.headers.get("fileName")??"",b="Chat",P=n?.codeSelection??"";if(f){b=f+"CodeGPT";let e=await (0,u.u)({promptType:f,cleanPromptText:n.content+P,language:w});e&&(s[s.length-1].content=e+n.content+P)}let T=(t=(t=h??"").toLowerCase(),!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(t));T&&(x?s=[{role:"system",content:[{type:"text",text:"Create a detailed description of the image.\n\nYou have provided an image. I will describe it unless you provide a specific instruction."}]},{role:"user",content:[{type:"image_url",image_url:{url:x,detail:"high"}},...n.content?[{type:"text",text:n.content}]:[]]}]:s.unshift({role:"system",content:"Act as an expert UX/UI designer. Create a detailed description of the image.\n\nYou have provided an image. I will describe it unless you provide a specific instruction.\n\nI am a helpful programming expert assistant. If you ask me a question that is rooted in truth. Follow the user's instructions with precision and attention to detail. Provide the code in a single block. Minimize any additional text."}));try{let e=r?.organization_id,t=!!r?.apikey,n=a.vc.getByProvider("CodeGPT Enterprise"),u={...t?T?{model:h?.toLowerCase()}:{agentId:h}:{model:"gpt-3.5-turbo"},messages:s,temperature:n?.temperature??.3},g=t?T?`${o}/chat/completion`:y?`${o}/chat/marketplace/agents`:`${o}/chat/extension`:`${o}/chat/limited`;s=(0,d.VL)(s);let x=await fetch(g,{method:"POST",headers:{Authorization:`Bearer ${r?.apikey||""}`,"Content-Type":"application/json",tokens:"true",source:"api",channel:p.L_,...e?{"CodeGPT-Org-Id":e}:{}},body:JSON.stringify(u)});if(console.log({url:g,body:u}),(0,i.sendEvent)({eventName:b,provider:"CodeGPT Enterprise",model:T?h??"gpt-3.5-turbo":"agentId: "+h,statusCode:x.status}),429===x.status)return Response.json({message:"You have reached the daily limit of requests. Please wait until the next period starts or upgrade your plan."},{status:429});let w=await m(x),k=s.slice(0,-1).some(e=>e.content.includes(P));if(P&&(f||!k)){let e=await (0,l.VU)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${f?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${f}</span></span>`:""}${v?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${q} data-language=${q}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${v}</span></span>`:""}</p>`],w);return new c.w(e)}return new c.w(w)}catch(e){return(0,i.sendEvent)({eventName:b,provider:"CodeGPT Enterprise",model:T?h??"gpt-3.5-turbo":"agentId: "+h,statusCode:e.status??500}),Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}[a,i,d,l,g]=x.then?(await x)():x;let w={...n},v="workUnitAsyncStorage"in w?w.workUnitAsyncStorage:"requestAsyncStorage"in w?w.requestAsyncStorage:void 0;function q(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,o)=>{let n;try{let e=v?.getStore();n=e?.headers}catch(e){}return s.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/[port]/api/(providers)/(codegpt)/codegptenterprise",headers:n}).apply(r,o)}})}let b=q(y,"GET"),P=q(f,"POST"),T=q(void 0,"PUT"),k=q(void 0,"PATCH"),C=q(void 0,"DELETE"),E=q(h,"HEAD"),_=q(void 0,"OPTIONS");o()}catch(e){o(e)}})},26687:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l});var s=r(97988),n=r(7773),a=r(94049),i=r(90635),p=e([i]);i=(p.then?(await p)():p)[0];let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/[port]/api/(providers)/(codegpt)/codegptenterprise/route",pathname:"/[port]/api/codegptenterprise",filename:"route",bundlePath:"app/[port]/api/(providers)/(codegpt)/codegptenterprise/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/(codegpt)/codegptenterprise/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:g}=u,x="/[port]/api/(providers)/(codegpt)/codegptenterprise/route";function d(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}o()}catch(e){o(e)}})},97988:(e,t,r)=>{e.exports=r(30517)},95403:(e,t,r)=>{r.d(t,{w:()=>o});class o extends Response{constructor(e,t){super(e,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...t?.headers}})}}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[2355,8622,8341,8823,6703,5538,2806,981,3474,5203,4554,5370,3228,3536],()=>r(26687));module.exports=o})();
//# sourceMappingURL=route.js.map