try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8217d9b8-00cd-4613-9688-a064e14bc8b7",e._sentryDebugIdIdentifier="sentry-dbid-8217d9b8-00cd-4613-9688-a064e14bc8b7")}catch(e){}"use strict";(()=>{var e={};e.id=5362,e.ids=[5362],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},74675:e=>{e.exports=require("node:assert")},92761:e=>{e.exports=require("node:async_hooks")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},40027:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},95953:e=>{e.exports=require("node:dns")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},42725:e=>{e.exports=require("node:http2")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},38846:e=>{e.exports=require("node:perf_hooks")},39630:e=>{e.exports=require("node:querystring")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},93746:e=>{e.exports=require("node:util/types")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},43426:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{DELETE:()=>S,GET:()=>_,HEAD:()=>$,OPTIONS:()=>E,PATCH:()=>I,POST:()=>A,PUT:()=>j,dynamic:()=>P});var s=r(88622),a=r(54580),n=r(25187),i=r(74554),p=r(38485),d=r(45219),u=r(48449),l=r(50838),c=r(22815),g=r(95403),m=r(34160),x=r(65195),h=r(13576),y=e([n,p,d,l,m,x,h]);[n,p,d,l,m,x,h]=y.then?(await y)():y;let P="force-dynamic",b=i.xf;async function f(){let e=await (0,h.Z)();return Response.json("",{status:e||p.ZI.getByProvider("CodeGPT Plus Beta")?.apikey?200:401})}let T=async(e,t)=>{await (0,n.cleanKVCache)({type:"agents",currentKey:e});try{let r={Authorization:`Bearer ${e}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",...t?{"CodeGPT-Org-Id":t}:{}},o=await Promise.all([fetch(`${i.xf}/agents`,{headers:r}).then(e=>e.json()),fetch(`${i.xf}/agents/marketplace-favorites`,{headers:r}).then(e=>e.json())]),s={agents:Array.isArray(o[0])?o[0]:[],marketplace:Array.isArray(o[1])?o[1]:[]};return(0,n.setKeyValue)(`agents-${e}`,s),s}catch(e){return console.log({agentsError:e.message}),{agents:[],marketplace:[]}}};async function q(){try{let e=p.ZI.getByProvider("CodeGPT Plus Beta"),t=e?.organization_id,r=await (0,h.Z)()||e?.apikey;if(!r)return Response.json({agents:[],marketplace:[]});{let e=await (0,n.getKeyValue)(`agents-${r}`);if(e)return T(r,t),Response.json(e);{let e=await T(r,t);return Response.json(e)}}}catch(e){return console.log(e),Response.json(e.message,{status:e.status??500})}}async function w(e){var t;let r=p.ZI.getByProvider("CodeGPT Plus Beta"),{messages:o}=await e.json(),s=o[o.length-1],{image:a}=s,i=await (0,n.getDefaultAgent)(),y=a?"gpt-4o-mini":e.headers.get("model")||i.id,f="true"===e.headers.get("fromMarketplace")||y===i.id;console.log("Agent from Marketplace",f),o=await (0,l.Dz)({messages:o,fromMarketplace:f,provider:"CodeGPT Plus Beta"});let q=e.headers.get("filePath"),w=e.headers.get("promptType"),v="53f3c928-9d9f-4aae-a3e1-058d657f286a"===y||"stackOverflow"===w,P=await x.Z.getLanguage(),T=await x.Z.getIdeLanguage(),k=e.headers.get("fileName")??"",C="Chat",_=s?.codeSelection??"";if(w&&!v){C=w+"CodeGPT";let e=await (0,c.u)({promptType:w,cleanPromptText:s.content+_,language:T});e&&(o[o.length-1].content=e+s.content+_)}if(q){let e=JSON.stringify(await (0,n.getFileContent)(q),null,2);o[o.length-1].content+=`${q}

    ${e}`}let A=(t=(t=y??"").toLowerCase(),!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(t));A&&a&&(o=[{role:"system",content:[{type:"text",text:"You have provided an image. I will describe it unless you provide a specific instruction."}]},{role:"user",content:[{type:"image_url",image_url:{url:a,detail:"high"}},...s.content?[{type:"text",text:s.content}]:[]]}]),v&&o.push({role:"system",content:`- You have been asked to search Stack Overflow for the given query.
- Use the searchStackOverflow function to search Stack Overflow and retrieve the most relevant results to respond to the user's query and give to user a complete response.`});try{let e=r?.organization_id,t=await (0,h.Z)(),a=!!(t||r?.apikey),i=s.statusId,c=p.vc.getByProvider("CodeGPT Plus Beta");o=(0,l.VL)(o);let T={...A?{model:y?.toLowerCase()}:{agentId:y},messages:o,temperature:c?.temperature??0,statusId:i},j=a?A?`${b}/chat/completion`:f?`${b}/chat/marketplace/agents`:`${b}/chat/extension`:`${b}/chat/limited`;console.log({isStackOverflow:v}),console.log({model:y,url:j});let I=p.PR.get(),S=I?.signed_distinct_id||"",$=I?.distinct_id||"",E=await (0,n.getKeyValue)("anonymousDistinctId"),O=async({messages:o,useFunctionPrompt:s,removeEmptyMessage:a})=>await fetch(j,{method:"POST",headers:{Authorization:`Bearer ${t||r?.apikey||""}`,"Content-Type":"application/json",tokens:"true",source:"api",channel:u.L_,"codegpt-version":await x.Z.getVersion(),"distinct-id":$||E,...S?{"X-Signed-Distinct-Id":S}:{},...e?{"CodeGPT-Org-Id":e}:{}},body:JSON.stringify({...T,messages:o,stream:!0,format:"json"})}),G=await O({messages:o,useFunctionPrompt:!1});if(console.log(G),G.ok||console.log({status:G.status,text:await G.text()}),(0,d.sendEvent)({eventName:C,provider:"CodeGPT Plus Beta",model:A?y??"gpt-4o-mini":"agentId: "+y,statusCode:G.status}),429===G.status)return Response.json({message:"You have reached your daily request limit. Connecto to CodeGPT Plus to increase your free daily limit or upgrade your plan for unlimited interactions."},{status:429});let R=o.slice(0,-1).some(e=>e.content.includes(_));if(q||_&&(w||!R)){let e=await (0,m.VU)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${w?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${w}</span></span>`:""}${k?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${P} data-language=${P}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${k}</span></span>`:""}${q?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-language=${q.split("/").pop()?.split(".").pop()}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${q.split("/").pop()}</span></span>`:""}</p>

`],G.body),t=(0,m.q_)(e,O,o);return new g.w(t)}let B=(0,m.q_)((0,m.lg)(G),O,o);return new g.w(B)}catch(e){return(0,d.sendEvent)({eventName:C,provider:"CodeGPT Plus Beta",model:A?y??"gpt-4o":"agentId: "+y,statusCode:e.status??500}),Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}let k={...a},C="workUnitAsyncStorage"in k?k.workUnitAsyncStorage:"requestAsyncStorage"in k?k.requestAsyncStorage:void 0;function v(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,o)=>{let a;try{let e=C?.getStore();a=e?.headers}catch(e){}return s.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/[port]/api/(providers)/(codegpt)/codegptplusbeta",headers:a}).apply(r,o)}})}let _=v(q,"GET"),A=v(w,"POST"),j=v(void 0,"PUT"),I=v(void 0,"PATCH"),S=v(void 0,"DELETE"),$=v(f,"HEAD"),E=v(void 0,"OPTIONS");o()}catch(e){o(e)}})},64254:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var s=r(97988),a=r(7773),n=r(94049),i=r(43426),p=e([i]);i=(p.then?(await p)():p)[0];let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/[port]/api/(providers)/(codegpt)/codegptplusbeta/route",pathname:"/[port]/api/codegptplusbeta",filename:"route",bundlePath:"app/[port]/api/(providers)/(codegpt)/codegptplusbeta/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/(codegpt)/codegptplusbeta/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:g}=u,m="/[port]/api/(providers)/(codegpt)/codegptplusbeta/route";function d(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}o()}catch(e){o(e)}})},97988:(e,t,r)=>{e.exports=r(30517)},95403:(e,t,r)=>{r.d(t,{w:()=>o});class o extends Response{constructor(e,t){super(e,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...t?.headers}})}}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[2355,8622,8341,8823,6703,5538,2806,981,3474,5203,4554,5370,3228,3536],()=>r(64254));module.exports=o})();
//# sourceMappingURL=route.js.map