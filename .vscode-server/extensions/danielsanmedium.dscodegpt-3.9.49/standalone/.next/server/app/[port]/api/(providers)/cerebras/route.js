try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="fe3c1241-aa00-451d-96ca-4a942e88db4a",e._sentryDebugIdIdentifier="sentry-dbid-fe3c1241-aa00-451d-96ca-4a942e88db4a")}catch(e){}"use strict";(()=>{var e={};e.id=9711,e.ids=[9711],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},74675:e=>{e.exports=require("node:assert")},92761:e=>{e.exports=require("node:async_hooks")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},40027:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},95953:e=>{e.exports=require("node:dns")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},42725:e=>{e.exports=require("node:http2")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},38846:e=>{e.exports=require("node:perf_hooks")},39630:e=>{e.exports=require("node:querystring")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},31764:e=>{e.exports=require("node:tls")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},93746:e=>{e.exports=require("node:util/types")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},81115:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{DELETE:()=>C,GET:()=>T,HEAD:()=>_,OPTIONS:()=>A,PATCH:()=>S,POST:()=>k,PUT:()=>E});var s=t(88622),a=t(54580),n=t(25187),i=t(38485),p=t(45219),d=t(48449),l=t(50838),u=t(6867),c=t(22815),x=t(95403),m=t(34160),h=t(81256),q=t(65195),g=t(17281),f=e([n,i,p,l,m,q]);async function y(){let e=i.ZI.getByProvider("Cerebras");return Response.json("",{status:e?.apikey?200:401})}async function w(e){let r=i.ZI.getByProvider("Cerebras"),t=new g.ZP({apiKey:r?.apikey||"",baseURL:"https://api.cerebras.ai/v1"}),{messages:o}=await e.json();o=await (0,l.Dz)({messages:o,provider:"Cerebras"});let s=e.headers.get("model")||"llama3.1-70b",a=e.headers.get("promptType"),f=e.headers.get("filePath"),y=await q.Z.getLanguage(),w=await q.Z.getIdeLanguage(),b=e.headers.get("fileName")??"",v="Chat",P=o[o.length-1],T=P?.codeSelection??"";if(a){v=a+"CodeGPT";let e=await (0,c.u)({promptType:a,cleanPromptText:P.content+T,language:w});e&&(o[o.length-1].content=e+P.content+T)}if(f){let e=JSON.stringify(await (0,n.getFileContent)(f),null,2);o[o.length-1].content+=`${f}
    
    ${e}`}if(!o.some(e=>"system"===e.role)){let e=await (0,d.Ox)({provider:"cerebras",model:s});o.unshift({role:"system",content:e||"I am a helpful programming expert assistant. If you ask me a question that is rooted in truth. Follow the user's instructions with precision and attention to detail. Provide the code in a single block. Minimize any additional text."})}let k=(0,h.q)(o.map(e=>e.content).join(""));try{if(!r?.apikey){let e=Error("You need to set your API key first.");throw e.status=401,e}let e=i.vc.getByProvider("Cerebras");console.log("---------NEW MESSAGES--------"),console.log(o),o=(0,l.VL)(o);let n=await t.chat.completions.create({model:s||"llama3.1-70b",stream:!0,messages:o,temperature:e?.temperature??.3}),d=await (0,u.H)(n.toReadableStream(),{onFinal:async e=>{let r=(0,h.q)(e);await (0,p.sendEvent)({eventName:v,provider:"Cerebras",model:s??"llama3.1-70b",promptTokens:k,completionTokens:r,totalTokens:k+r,statusCode:200})}}),c=o.slice(0,-1).some(e=>e.content.includes(T));if(f||T&&(a||!c)){let e=await (0,m.VU)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${a?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${a}</span></span>`:""}${b?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${y} data-language=${y}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${b}</span></span>`:""}${f?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-language=${f.split("/").pop()?.split(".").pop()}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${f.split("/").pop()}</span></span>`:""}</p>

`],d);return new x.w(e)}return new x.w(d)}catch(e){return(0,p.sendEvent)({eventName:v,provider:"Cerebras",model:s,promptTokens:k,totalTokens:k,statusCode:e.status??500}),Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}[n,i,p,l,m,q]=f.then?(await f)():f;let v={...a},P="workUnitAsyncStorage"in v?v.workUnitAsyncStorage:"requestAsyncStorage"in v?v.requestAsyncStorage:void 0;function b(e,r){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,t,o)=>{let a;try{let e=P?.getStore();a=e?.headers}catch(e){}return s.wrapRouteHandlerWithSentry(e,{method:r,parameterizedRoute:"/[port]/api/(providers)/cerebras",headers:a}).apply(t,o)}})}let T=b(void 0,"GET"),k=b(w,"POST"),E=b(void 0,"PUT"),S=b(void 0,"PATCH"),C=b(void 0,"DELETE"),_=b(y,"HEAD"),A=b(void 0,"OPTIONS");o()}catch(e){o(e)}})},88702:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>c});var s=t(97988),a=t(7773),n=t(94049),i=t(81115),p=e([i]);i=(p.then?(await p)():p)[0];let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/[port]/api/(providers)/cerebras/route",pathname:"/[port]/api/cerebras",filename:"route",bundlePath:"app/[port]/api/(providers)/cerebras/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/cerebras/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:x}=l,m="/[port]/api/(providers)/cerebras/route";function d(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:c})}o()}catch(e){o(e)}})},6867:(e,r,t)=>{t.d(r,{H:()=>o});async function o(e,r){if(!e)throw Error("No response available");let t=e.getReader();if(!t)throw Error("No reader available");let o="";return new ReadableStream({async start(e){let s=new TextDecoder,a=new TextEncoder;for(r?.onStart?.();;){let{done:n,value:i}=await t.read();if(n){e.close(),r?.onFinal?.(o),r?.onCompletion?.(o);return}for(let t of s.decode(i).split("\n").filter(Boolean))try{if(!t)continue;let s=JSON.parse(t.trim().replace("data: ","")),n=s?.choices?.[0]?.delta?.content||s?.choices?.[0]?.text;n&&(e.enqueue(a.encode(n)),r?.onToken?.(n),o+=n)}catch{}}},cancel(){r?.onFinal?.(o),t.releaseLock()}})}},95403:(e,r,t)=>{t.d(r,{w:()=>o});class o extends Response{constructor(e,r){super(e,{...r,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...r?.headers}})}}},81256:(e,r,t)=>{t.d(r,{q:()=>s});var o=t(981);let s=(e,r)=>(0,o.b9)(r??"gpt-4").encode(e).length??0}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[2355,8622,8341,8823,6703,5538,2806,981,3474,6361,513,7281,5203,4554,5370,3228,3536],()=>t(88702));module.exports=o})();
//# sourceMappingURL=route.js.map