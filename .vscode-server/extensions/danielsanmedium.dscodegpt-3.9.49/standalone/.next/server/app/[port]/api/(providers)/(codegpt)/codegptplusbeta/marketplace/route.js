try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="44c4de15-0df1-4e18-a231-3d8b812dc3d9",e._sentryDebugIdIdentifier="sentry-dbid-44c4de15-0df1-4e18-a231-3d8b812dc3d9")}catch(e){}"use strict";(()=>{var e={};e.id=9400,e.ids=[9400],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},17718:e=>{e.exports=require("node:child_process")},65714:e=>{e.exports=require("node:diagnostics_channel")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},47261:e=>{e.exports=require("node:util")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},11311:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{DELETE:()=>v,GET:()=>y,HEAD:()=>w,OPTIONS:()=>_,PATCH:()=>q,POST:()=>f,PUT:()=>m});var o=r(88622),a=r(54580),i=r(13576),n=r(74554),c=r(38485),p=r(45219),d=r(88823),u=e([i,c,p]);async function l(e){let{agentId:t}=await e.json(),r=c.ZI.getByProvider("CodeGPT Plus Beta"),s=r?.organization_id,o=await (0,i.Z)();if(!o)return Response.json("Please login to use this feature.",{status:428});let a={Authorization:`Bearer ${o||r?.apikey}`,"Content-Type":"application/json",...s?{"CodeGPT-Org-Id":s}:{},"Access-Control-Allow-Origin":"*"},u=await d.Z.post(`${n.xf}/agents/marketplace-favorites/${t}`,{},{headers:a});return await (0,p.sendEvent)({eventName:"Marketplace Favorite",provider:"CodeGPT Plus Beta",model:t,statusCode:u.status}),Response.json({status:u.status,data:u.data})}[i,c,p]=u.then?(await u)():u;let h={...a},x="workUnitAsyncStorage"in h?h.workUnitAsyncStorage:"requestAsyncStorage"in h?h.requestAsyncStorage:void 0;function g(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,s)=>{let a;try{let e=x?.getStore();a=e?.headers}catch(e){}return o.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/[port]/api/(providers)/(codegpt)/codegptplusbeta/marketplace",headers:a}).apply(r,s)}})}let y=g(void 0,"GET"),f=g(l,"POST"),m=g(void 0,"PUT"),q=g(void 0,"PATCH"),v=g(void 0,"DELETE"),w=g(void 0,"HEAD"),_=g(void 0,"OPTIONS");s()}catch(e){s(e)}})},86925:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>p,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l});var o=r(97988),a=r(7773),i=r(94049),n=r(11311),c=e([n]);n=(c.then?(await c)():c)[0];let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/[port]/api/(providers)/(codegpt)/codegptplusbeta/marketplace/route",pathname:"/[port]/api/codegptplusbeta/marketplace",filename:"route",bundlePath:"app/[port]/api/(providers)/(codegpt)/codegptplusbeta/marketplace/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/(codegpt)/codegptplusbeta/marketplace/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:g}=d,h="/[port]/api/(providers)/(codegpt)/codegptplusbeta/marketplace/route";function p(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}s()}catch(e){s(e)}})},89933:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{setVicunaSession:()=>u});var o=r(71577);r(90710);var a=r(74554),i=r(38485),n=r(74395),c=r(74377),p=r(93205),d=e([i]);i=(d.then?(await d)():d)[0];let u=async({accessToken:e,refreshToken:t,expiresAt:r})=>{console.log("SET VICUNA SESSION"),e||t||r||(0,n.R)((0,c.cookies)()).auth.signOut({scope:"local"}).catch(e=>console.log(e));let s=e||i.ZI.getByProvider("CodeGPT Plus Beta")?.apikey,o=await fetch(`${a.xf}/me`,{method:"GET",cache:"no-store",...s?{headers:{Authorization:`Bearer ${s}`}}:{}}),p=await o.json(),d=p?.user?.distinct_id,u=p?.signedDistinctId;i.PR.upsert({access_token:e,refresh_token:t,expires_at:Number(r),signed_distinct_id:u,distinct_id:d})};(0,p.h)([u]),(0,o.j)("cb8707d39cee2d6b73f7d2a0c3a37eb9243fb61d",u),s()}catch(e){s(e)}})},13576:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Z:()=>p});var o=r(89933),a=r(38485),i=r(74395),n=r(74377),c=e([o,a]);async function p(){let e=a.PR.get(),t=e?.access_token;if(t&&parseInt(e?.expires_at+"000")<Date.now()){let r=(0,i.R)((0,n.cookies)()),{data:s,error:a}=await r.auth.refreshSession({refresh_token:e?.refresh_token});a?(console.log("vicu\xf1a refreshSession error: ",a.message),(a.message.includes("Refresh Token Not Found")||a.message.includes("Already Used"))&&await (0,o.setVicunaSession)({accessToken:"",refreshToken:"",expiresAt:""})):(await (0,o.setVicunaSession)({accessToken:s.session.access_token,refreshToken:s.session.refresh_token,expiresAt:String(s.session.expires_at)}),t=s.session.access_token)}return t||void 0}[o,a]=c.then?(await c)():c,s()}catch(e){s(e)}})},97988:(e,t,r)=>{e.exports=r(30517)},74395:(e,t,r)=>{r.d(t,{R:()=>i});var s=r(85538);let o="https://auth.codegpt.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyb3h1dnNyc2RieGFjb2twcmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTU0OTEyNzgsImV4cCI6MjAxMTA2NzI3OH0.fyyxVq2c2eLIExMQEUxP8wNoyY2UumBrfN5So16TCno";(0,s.createBrowserClient)(o,a);let i=e=>(0,s.createServerClient)(o,a,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})},45219:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{sendEvent:()=>y,sendEventNewChat:()=>f});var o=r(71577);r(90710);var a=r(25187),i=r(13576),n=r(74554),c=r(38485),p=r(48449),d=r(65195),u=r(88823),l=r(93205),g=e([a,i,c,d]);[a,i,c,d]=g.then?(await g)():g;let x=!1,y=async({eventName:e,groupBy:t,provider:r,model:s,promptTokens:o,completionTokens:i,totalTokens:n,target:u,value:l,statusCode:g,object:y,message:f,code_language:m,functionName:q,codeLinesNumber:v,flowVersion:w})=>{let _=async()=>{let x=!c.PR.get()?.access_token,_=c.PR.get()?.signed_distinct_id,b=c.PR.get()?.distinct_id,k=await (0,a.getKeyValue)("anonymousDistinctId");if(console.log({userId:b,anonymousDistinctId:k}),!b&&!k)throw console.log({userId:b,anonymousDistinctId:k}),Error("No userId or anonymousDistinctId found");let[I,T,P]=await Promise.all([d.Z.getIdeLanguage(),d.Z.getVersion(),s?d.Z.getLanguage():""]),S={userType:x?"anonymous":"registered",...r?{provider:r}:{},...s?{model:s}:{},...o?{prompt_tokens:o}:{},...i?{completion_tokens:i}:{},...n?{total_tokens:n}:{},...u?{target:u}:{},...t?{groupBy:t}:{},...l?{value:l}:{},...y?{object:y}:{},...f?{message:f}:{},...P?{language_code:P}:{},...m?{code_language:m}:{},...q?{function_name:q}:{},...v?{codeLinesNumber:v}:{},...w?{flow_version:w}:{},language:I,source:p.L_,codeGPTVersion:T};h({event:e||"Chat",data:{...S,...g?{statusCode:g}:{}},userId:b||k||"",signedDistinctId:_||""})};if("PreSignUp_SignUp"!==e||x)setTimeout(_,5e3);else{x=!0;let e=Math.floor(4501*Math.random())+500;await new Promise(t=>setTimeout(t,e)),await _()}return null};async function h({event:e,data:t,userId:r,signedDistinctId:s}){let o=[{event:e,properties:{...t,time:Date.now(),distinct_id:r,$insert_id:crypto.randomUUID()}}],a=await (0,i.Z)();return u.Z.post(`${n.xf}/telemetry`,o,{headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{},...s?{"X-Signed-Distinct-Id":s}:{}}}).catch(e=>{console.error("Error sending telemetry",e)}),null}let f=async({agentId:e})=>{let t=await (0,i.Z)();return fetch(`${n.xf}/logs/new-chat-metrics`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({agentId:e,source:p.L_.toUpperCase()})}),null};(0,l.h)([y,f]),(0,o.j)("395448ad66a04a8ccb5507391feafc0ccded9c25",y),(0,o.j)("42b7a0b34b7c38c34b9d081dace60a2396fdfcc8",f),s()}catch(e){s(e)}})}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[2355,8622,8341,8823,6703,5538,2806,5203,4554,5370],()=>r(86925));module.exports=s})();
//# sourceMappingURL=route.js.map