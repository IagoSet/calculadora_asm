try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="8487465e-81d1-4f2d-8151-61b92e16de76",e._sentryDebugIdIdentifier="sentry-dbid-8487465e-81d1-4f2d-8151-61b92e16de76")}catch(e){}"use strict";(()=>{var e={};e.id=2141,e.ids=[2141],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},85807:e=>{e.exports=require("module")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},35816:e=>{e.exports=require("process")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},17718:e=>{e.exports=require("node:child_process")},65714:e=>{e.exports=require("node:diagnostics_channel")},87561:e=>{e.exports=require("node:fs")},88849:e=>{e.exports=require("node:http")},22286:e=>{e.exports=require("node:https")},85690:e=>{e.exports=require("node:inspector")},87503:e=>{e.exports=require("node:net")},70612:e=>{e.exports=require("node:os")},49411:e=>{e.exports=require("node:path")},51747:e=>{e.exports=require("node:readline")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},47261:e=>{e.exports=require("node:util")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},1024:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{DELETE:()=>v,GET:()=>y,HEAD:()=>S,OPTIONS:()=>T,PATCH:()=>P,POST:()=>w,PUT:()=>b});var o=t(88622),n=t(54580),i=t(25187),a=t(73228),p=t(38485),l=t(95403),u=t(13576),d=e([i,a,p,u]);[i,a,p,u]=d.then?(await d)():d;let h=(e,r,t="")=>{e.enqueue(JSON.stringify({progress:Math.min(Math.round(r),100),total:100,message:t})+"\n\n")},g=()=>{global.gc&&global.gc()},f=async({batch:e,workspaceId:r,session:t,maxRetries:s=3,retryDelay:o=1e3})=>{let n=0;for(;n<s;)try{return await (0,a.oQ)({chunks:e,workspaceId:r,session:t})}catch(e){if(n++,console.error(`Error processing batch (attempt ${n}/${s}):`,e.message),n>=s)return console.error("Max retries reached, giving up on this batch"),[];await new Promise(e=>setTimeout(e,o))}return[]};async function c(){let e=await (0,u.Z)();if(!e)return Response.json({message:"No Session found"},{status:401});try{let r=new ReadableStream({async start(r){h(r,1,"Getting files");let t=(await (0,i.getAllPathsFromProject)()).filter(e=>!a.Wy.test(e)&&!/(^|\/)\./.test(e)),s=await Promise.all(t.map(e=>(0,i.getFileContent)(e)));h(r,5,"Reading files");let o=[];for(let e=0;e<t.length;e+=100){let r=t.slice(e,e+100),n=s.slice(e,e+100),i=(await Promise.all(r.map((e,r)=>(0,a.qm)({fileName:e,fileContent:n[r]})))).flat(1);o=[...o,...i],n.length=0,g()}h(r,10,"Reading files");let{workspaceId:n}=await (0,a.cm)();if(!n)return;let l=new Set(await (0,a.ln)({workspaceId:n,session:e})),u=new Set(o.map(e=>e.hash)),d=new Set([...l].filter(e=>!u.has(e))),c=o.filter(e=>!l.has(e.hash));o=[],g(),h(r,20,"Reading files");let x=Array.from({length:Math.ceil(c.length/288)},(e,r)=>c.slice(288*r,288*r+288));for(let t=0;t<x.length;t+=3){let s=x.slice(t,t+3).map((s,o)=>{let i=t+o,a=performance.now(),l=20+i/x.length*75,u=20+(i+1)/x.length*75,d=(u-l)/8,c=setInterval(()=>{let e=performance.now()-a,t=Math.floor(e/1e3);if(t<8){let e=l+d*t;h(r,e,"Indexing Project")}},1e3);return f({batch:s,workspaceId:n,session:e}).then(e=>(clearInterval(c),e.length>0&&p.OZ.upsert(e.map(e=>({workspace_id:n,origin_file:e.fileName,hash:e.hash}))),h(r,u,"Indexing Project"),s.length=0,g(),e))});await Promise.all(s)}h(r,95,"Finalizing"),await (0,a.$O)({request:{workspaceId:n,chunks:[]},session:e}),d.size>0&&(await (0,a.bU)({workspaceId:n,session:e,hashes:Array.from(d)}),p.OZ.delete(n,Array.from(d))),r.close()}});return new l.w(r)}catch(e){return console.log(e),Response.json({message:e.message},{status:500})}}let q={...n},m="workUnitAsyncStorage"in q?q.workUnitAsyncStorage:"requestAsyncStorage"in q?q.requestAsyncStorage:void 0;function x(e,r){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,t,s)=>{let n;try{let e=m?.getStore();n=e?.headers}catch(e){}return o.wrapRouteHandlerWithSentry(e,{method:r,parameterizedRoute:"/[port]/api/index-codebase",headers:n}).apply(t,s)}})}let y=x(c,"GET"),w=x(void 0,"POST"),b=x(void 0,"PUT"),P=x(void 0,"PATCH"),v=x(void 0,"DELETE"),S=x(void 0,"HEAD"),T=x(void 0,"OPTIONS");s()}catch(e){s(e)}})},91648:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>l,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>x,staticGenerationAsyncStorage:()=>c});var o=t(97988),n=t(7773),i=t(94049),a=t(1024),p=e([a]);a=(p.then?(await p)():p)[0];let u=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/[port]/api/index-codebase/route",pathname:"/[port]/api/index-codebase",filename:"route",bundlePath:"app/[port]/api/index-codebase/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/index-codebase/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:x}=u,h="/[port]/api/index-codebase/route";function l(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:c})}s()}catch(e){s(e)}})},97988:(e,r,t)=>{e.exports=t(30517)},95403:(e,r,t)=>{t.d(r,{w:()=>s});class s extends Response{constructor(e,r){super(e,{...r,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...r?.headers}})}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[2355,8622,8341,8823,6703,5538,2806,981,5203,4554,5370,3228],()=>t(91648));module.exports=s})();
//# sourceMappingURL=route.js.map