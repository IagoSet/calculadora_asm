try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d3c3026b-b43f-42a0-9d65-7f6d5e3a6c1a",e._sentryDebugIdIdentifier="sentry-dbid-d3c3026b-b43f-42a0-9d65-7f6d5e3a6c1a")}catch(e){}(()=>{var e={};e.id=7707,e.ids=[7707],e.modules={14464:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=14464,e.exports=t},12308:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=12308,e.exports=t},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{"use strict";e.exports=require("async_hooks")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},27920:e=>{"use strict";e.exports=require("diagnostics_channel")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},85807:e=>{"use strict";e.exports=require("module")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},96119:e=>{"use strict";e.exports=require("perf_hooks")},35816:e=>{"use strict";e.exports=require("process")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},17718:e=>{"use strict";e.exports=require("node:child_process")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},85690:e=>{"use strict";e.exports=require("node:inspector")},87503:e=>{"use strict";e.exports=require("node:net")},70612:e=>{"use strict";e.exports=require("node:os")},49411:e=>{"use strict";e.exports=require("node:path")},51747:e=>{"use strict";e.exports=require("node:readline")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},47261:e=>{"use strict";e.exports=require("node:util")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},90281:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>U,patchFetch:()=>C,requestAsyncStorage:()=>j,routeModule:()=>S,serverHooks:()=>I,staticGenerationAsyncStorage:()=>D});var s={};r.r(s),r.d(s,{DELETE:()=>_,GET:()=>T,HEAD:()=>E,OPTIONS:()=>P,PATCH:()=>O,POST:()=>k,PUT:()=>A});var o=r(97988),i=r(7773),n=r(94049),a=r(88622),u=r(54580);let c=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,l="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",d=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g;class p extends Error{constructor(e){super(`[YoutubeTranscript] ðŸš¨ ${e}`)}}class g extends p{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}}class h extends p{constructor(e){super(`The video is no longer available (${e})`)}}class x extends p{constructor(e){super(`Transcript is disabled on this video (${e})`)}}class v extends p{constructor(e){super(`No transcripts are available for this video (${e})`)}}class f extends p{constructor(e,t,r){super(`No transcripts are available in ${e} this video (${r}). Available languages: ${t.join(", ")}`)}}class y{static fetchTranscript(e,t){var r,s,o,i,n;return s=this,o=void 0,i=void 0,n=function*(){let s=this.retrieveVideoId(e),o=yield fetch(`https://www.youtube.com/watch?v=${s}`,{headers:Object.assign(Object.assign({},(null==t?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":l})}),i=yield o.text(),n=i.split('"captions":');if(n.length<=1){if(i.includes('class="g-recaptcha"'))throw new g;if(!i.includes('"playabilityStatus":'))throw new h(e);throw new x(e)}let a=null===(r=(()=>{try{return JSON.parse(n[1].split(',"videoDetails')[0].replace("\n",""))}catch(e){return}})())||void 0===r?void 0:r.playerCaptionsTracklistRenderer;if(!a)throw new x(e);if(!("captionTracks"in a))throw new v(e);if((null==t?void 0:t.lang)&&!a.captionTracks.some(e=>e.languageCode===(null==t?void 0:t.lang)))throw new f(null==t?void 0:t.lang,a.captionTracks.map(e=>e.languageCode),e);let u=((null==t?void 0:t.lang)?a.captionTracks.find(e=>e.languageCode===(null==t?void 0:t.lang)):a.captionTracks[0]).baseUrl,c=yield fetch(u,{headers:Object.assign(Object.assign({},(null==t?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":l})});if(!c.ok)throw new v(e);return[...(yield c.text()).matchAll(d)].map(e=>{var r;return{text:e[3],duration:parseFloat(e[2]),offset:parseFloat(e[1]),lang:null!==(r=null==t?void 0:t.lang)&&void 0!==r?r:a.captionTracks[0].languageCode}})},new(i||(i=Promise))(function(e,t){function r(e){try{u(n.next(e))}catch(e){t(e)}}function a(e){try{u(n.throw(e))}catch(e){t(e)}}function u(t){var s;t.done?e(t.value):((s=t.value)instanceof i?s:new i(function(e){e(s)})).then(r,a)}u((n=n.apply(s,o||[])).next())})}static retrieveVideoId(e){if(11===e.length)return e;let t=e.match(c);if(t&&t.length)return t[1];throw new p("Impossible to retrieve Youtube video ID.")}}async function b(e){let{url:t}=await e.json();try{let e=await y.fetchTranscript(t);return Response.json({status:200,transcript:e})}catch(e){return Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}let q={...u},w="workUnitAsyncStorage"in q?q.workUnitAsyncStorage:"requestAsyncStorage"in q?q.requestAsyncStorage:void 0;function m(e,t){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,r,s)=>{let o;try{let e=w?.getStore();o=e?.headers}catch(e){}return a.wrapRouteHandlerWithSentry(e,{method:t,parameterizedRoute:"/api/ingestor/youtube",headers:o}).apply(r,s)}})}let T=m(void 0,"GET"),k=m(b,"POST"),A=m(void 0,"PUT"),O=m(void 0,"PATCH"),_=m(void 0,"DELETE"),E=m(void 0,"HEAD"),P=m(void 0,"OPTIONS"),S=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/ingestor/youtube/route",pathname:"/api/ingestor/youtube",filename:"route",bundlePath:"app/api/ingestor/youtube/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/api/ingestor/youtube/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:D,serverHooks:I}=S,U="/api/ingestor/youtube/route";function C(){return(0,n.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:D})}},97988:(e,t,r)=>{"use strict";e.exports=r(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[2355,8622],()=>r(90281));module.exports=s})();
//# sourceMappingURL=route.js.map